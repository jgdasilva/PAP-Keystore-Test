global:
  vault:
    enabled: true
    hashicorp:
      annotations:
        role: ping-ps-aws-us-west-2
        log-level: debug

        # In order to put down the keystore file on the image and have it
        # decoded to the proper binary format the following five annotations must
        # be defined. The "-adminkeystore.p12" part of the annotation key is used
        # to tie all five together. The block below is for the admin keystore.
        #
        #
        # This identifies the location of the secret, your deployment will of
        # course be for your vaul secret account.
        agent-inject-secret-adminkeystore.p12: secret/jdasilva@pingidentity.com/ping-devops-jdasilva/pap-keystores
        # This defines the name of the file on the image that will
        # hold the secret. This will will be decoded later.
        agent-inject-file-adminkeystore.p12: admin
        # This defines the path on image where the above file is placed
        secret-volume-path-adminkeystore.p12: /opt/staging/instance/config
        # This is a template that extracts the admin key from the secret to
        # place in the above file. The .Data.data.admin is the reference to
        # the JSON key value "admin"
        agent-inject-template-adminkeystore.p12: |
          {{ with secret "secret/jdasilva@pingidentity.com/ping-devops-jdasilva/pap-keystores" }}
          {{ .Data.data.admin }}
          {{ end }}
        # This takes the file and decodes it placing it into the final file
        # that will be referenced in your configuration.
        agent-inject-command-adminkeystore.p12: bin/sh -c "base64 -d /opt/staging/instance/config/admin >/opt/staging/instance/config/admin-keystore.p12"

        # The following five are for the server keystore, same notes and
        # explanation as above covers these.
        # For the following the key name for the secret is "server" along with
        # the file name for the encoded file.
        agent-inject-secret-keystore.p12: secret/jdasilva@pingidentity.com/ping-devops-jdasilva/pap-keystores
        agent-inject-file-keystore.p12: server
        secret-volume-path-keystore.p12: /opt/staging/instance/config
        agent-inject-template-keystore.p12: |
          {{ with secret "secret/jdasilva@pingidentity.com/ping-devops-jdasilva/pap-keystores" }}
          {{ .Data.data.server }}
          {{ end }}
        agent-inject-command-keystore.p12: bin/sh -c "base64 -d /opt/staging/instance/config/server >/opt/staging/instance/config/keystore.p12"

      secretPrefix: secret/jdasilva@pingidentity.com/ping-devops-jdasilva/
      secrets:
        # The following generates a devops-secret.env from the secret
        # "pap-keystore-passwords"
        pap-keystore-passwords:
          to-json:
            file: devops-secret.env
        # The following places a license fle down on the image
        ping-licenses:
          pingauthorize-9.0.0.0:
            path: /opt/in/instance/
            file: PingAuthorize.lic

pingauthorizepap:
  enabled: true
  envs:
    SERVER_PROFILE_URL: https://github.com/jgdasilva/PAP-Keystore-Test.git
    SERVER_PROFILE_PATH: pingauthorizepap
